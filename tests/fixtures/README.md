# Test Fixtures for Phase 6 (Task Expansion)

This directory contains test fixtures and utilities for comprehensive Phase 6 CLI testing.

## Overview

The improved Phase 6 testing strategy includes:

1. **Integration Tests** - Real LLM calls for end-to-end validation
2. **Unit Tests** - Mock-based tests for fast feedback and edge cases  
3. **Fixture-Based Tests** - Pre-generated LLM data for consistent results

## Files

### `test_prd_for_expansion.txt`
A realistic Product Requirements Document (PRD) for a task management application. This PRD is used to generate real project plans and tasks via LLM calls.

### `generate_expansion_fixtures.py` 
Script to generate test fixtures by making real LLM calls. This creates realistic test data that can be used in both integration and unit tests.

**Usage:**
```bash
# Ensure you have Google API key set up
export GOOGLE_API_KEY="your-google-api-key"

# Generate fixtures
cd /path/to/claude-task-master
python tests/fixtures/generate_expansion_fixtures.py
```

This will create `phase6_expansion_fixtures.json` with:
- Base project plan generated from the test PRD using Google's LLM
- Tasks with LLM-generated subtasks
- Sample subtasks for testing

### `phase6_expansion_fixtures.json` (Generated)
JSON file containing real LLM-generated test data:
- Project plan with realistic tasks
- Tasks with subtasks generated by Google's LLM
- Individual subtasks for testing

## Testing Strategy

### 1. Integration Tests (Real LLM)
- **Purpose**: End-to-end validation with real LLM interactions
- **Speed**: Slow (makes actual API calls)
- **Reliability**: Tests real system behavior
- **Environment**: Requires `ENABLE_LLM_TESTS=1`

```bash
# Enable and run integration tests
export ENABLE_LLM_TESTS=1
pytest tests/cli/test_cli_phase6_improved.py::TestExpandCommandIntegration -v
```

### 2. Unit Tests (Mocked)
- **Purpose**: Fast feedback, edge cases, error handling
- **Speed**: Fast (no API calls)
- **Reliability**: Predictable, deterministic
- **Environment**: Always enabled

```bash
# Run unit tests (default)
pytest tests/cli/test_cli_phase6_improved.py::TestExpandCommandUnit -v
```

### 3. Fixture-Based Tests
- **Purpose**: Consistent testing with realistic data
- **Speed**: Fast (uses pre-generated data)
- **Reliability**: Consistent results, realistic content
- **Environment**: Uses generated fixtures

```bash
# Run fixture-based tests
pytest tests/cli/test_cli_phase6_improved.py::TestExpandCommandFixtureBased -v
```

## Running Tests

### All Tests (Fast - Unit + Fixture only)
```bash
pytest tests/cli/test_cli_phase6_improved.py -v
```

### Include Integration Tests
```bash
export ENABLE_LLM_TESTS=1
pytest tests/cli/test_cli_phase6_improved.py -v
```

### Generate Fresh Fixtures
```bash
# Regenerate fixtures with current LLM models
python tests/fixtures/generate_expansion_fixtures.py

# Run tests with new fixtures
pytest tests/cli/test_cli_phase6_improved.py::TestExpandCommandFixtureBased -v
```

## Best Practices

### When to Use Each Test Type

1. **Integration Tests**:
   - Validating end-to-end functionality
   - Testing with new LLM models or prompts
   - Regression testing for LLM behavior changes
   - CI/CD pipeline (nightly builds)

2. **Unit Tests**:
   - Development and debugging
   - Testing error conditions and edge cases
   - Parameter validation
   - Fast CI/CD feedback

3. **Fixture-Based Tests**:
   - Consistent regression testing
   - Testing UI display logic with realistic data
   - Performance testing with known data sets
   - Local development without API costs

### Fixture Regeneration

Regenerate fixtures when:
- LLM prompts or models change significantly
- Adding new test scenarios
- Fixtures become outdated (>1 month old)
- Testing new features that require different data

### Environment Variables

- `ENABLE_LLM_TESTS=1` - Enable integration tests with real LLM calls
- `GOOGLE_API_KEY` - API key for Google's LLM models (required for fixtures and integration tests)

## File Structure

```
tests/fixtures/
├── README.md                          # This documentation
├── test_prd_for_expansion.txt         # Test PRD for generating plans
├── generate_expansion_fixtures.py     # Fixture generation script
└── phase6_expansion_fixtures.json     # Generated fixtures (git-ignored)
```

## Contributing

When adding new Phase 6 tests:

1. Add unit tests for core functionality (fast feedback)
2. Add integration tests for critical user journeys
3. Update fixture generation if new data types are needed
4. Document any new environment requirements
5. Ensure tests work both with and without fixtures

## Troubleshooting

### "No tasks in LLM fixtures" - Skip Message
- Fixtures haven't been generated yet
- Run the fixture generation script first

### Integration Tests Not Running
- Check `ENABLE_LLM_TESTS` environment variable
- Verify LLM API keys are configured
- Check network connectivity for API calls

### Fixture Generation Fails
- Verify LLM configuration in workspace
- Check API key validity and quota
- Ensure workspace has write permissions
- Review error messages for specific LLM issues